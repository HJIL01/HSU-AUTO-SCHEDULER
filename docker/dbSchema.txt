-- 학기 테이블
CREATE TABLE semester (
    semester_id VARCHAR(255) PRIMARY KEY,
    year INT NOT NULL,
    term INT NOT NULL CHECK (term IN (1, 2))
);

-- 전공 테이블
CREATE TABLE major (
    major_code VARCHAR(255) PRIMARY KEY,
    major_name VARCHAR(255) NOT NULL
);

-- 학기-전공 관계 테이블
CREATE TABLE semester_major (
  semester_id VARCHAR(255) NOT NULL,
  major_code VARCHAR(255) NOT NULL,
  PRIMARY KEY (semester_id, major_code),
  FOREIGN KEY (semester_id) REFERENCES semester(semester_id),
  FOREIGN KEY (major_code) REFERENCES major(major_code)
);


-- 강의 테이블
CREATE TABLE course (
    course_id VARCHAR(255) PRIMARY KEY,
    course_code VARCHAR(255) NOT NULL,
    course_name VARCHAR(255) NOT NULL,
    professor_name VARCHAR(255) NOT NULL,
    completion_type VARCHAR(255) NOT NULL,
    delivery_method VARCHAR(255) NOT NULL,
    credit INT NOT NULL,
    day_or_night VARCHAR(255) NOT NULL CHECK (day_or_night IN ('day', 'night', 'both')),
    class_section VARCHAR(255) NOT NULL,
    grade INT NOT NULL,
    grade_limit VARCHAR(255),
    online_min DECIMAL(2,1) DEFAULT 0,
    plan_code VARCHAR(255),
    semester_id VARCHAR(255) NOT NULL,
    FOREIGN KEY (semester_id) REFERENCES semester(semester_id)
);

-- 오프라인 시간표 테이블
CREATE TABLE offline_schedule (
    offline_schedule_id INT AUTO_INCREMENT PRIMARY KEY,
    day VARCHAR(255) NOT NULL,
    start_time INT NOT NULL,
    end_time INT NOT NULL,
    place VARCHAR(255) NOT NULL,
    course_id VARCHAR(255) NOT NULL,
    FOREIGN KEY (course_id) REFERENCES course(course_id) ON DELETE CASCADE,
    UNIQUE(course_id, day, start_time, end_time)
);

-- 전공-강의 관계 테이블
CREATE TABLE major_course (
    major_code VARCHAR(255) NOT NULL,
    course_id VARCHAR(255) NOT NULL,
    semester_id VARCHAR(255) NOT NULL,
    PRIMARY KEY (major_code, course_id, semester_id),
    FOREIGN KEY (major_code) REFERENCES major(major_code),
    FOREIGN KEY (course_id) REFERENCES course(course_id) ON DELETE CASCADE,
    FOREIGN KEY (semester_id) REFERENCES semester(semester_id)
);
